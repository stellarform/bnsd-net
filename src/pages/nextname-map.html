<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athlete Tracker</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <style>
        body {
            background-color: #333;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .map-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 1000px;
            height: auto;
            margin: 0 auto;
        }
        svg {
            width: 100%;
            height: auto;
        }
        .map {
            fill: black;
            stroke: #444;
            stroke-width: 0.5;
        }
        .line {
            fill: none;
            stroke: red;
            stroke-width: 2;
            stroke-linecap: round;
        }
        .dot {
            fill: red;
            stroke: red;
            stroke-width: 2;
            r: 3;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid white;
            padding: 8px;
            text-align: left;
        }
        th {
            cursor: pointer;
            position: relative;
        }

        th::after {
            content: " "; /* No line, just space */
            width: 12px;
            height: 3px;
            background-color: transparent;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.3s ease, font-size 0.3s ease; /* Transition for smooth arrow change */
        }

        th.asc::after {
            content: "↑"; /* Up arrow for ascending */
            font-size: 18px;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
        }

        th.desc::after {
            content: "↓"; /* Down arrow for descending */
            font-size: 18px;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
        }

        th:not(.asc):not(.desc)::after {
            content: ""; /* No symbol for inactive columns */
        }

        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }
        .popup-content {
            background-color: #444;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }
        .popup button {
            margin: 5px;
            padding: 10px;
            background-color: #333;
            color: white;
            border: none;
            cursor: pointer;
        }
        .popup button:hover {
            background-color: #666;
        }
        .sort-menu {
            display: none;
            position: absolute;
            background-color: #444;
            padding: 10px;
            border-radius: 5px;
            top: 100%;
            left: 0;
            width: 150px;
        }

        th:hover .sort-menu {
            display: block;
        }

        .sort-menu button {
            width: 100%;
            padding: 8px;
            background-color: #333;
            color: white;
            border: none;
            text-align: left;
        }

        .sort-menu button:hover {
            background-color: #666;
        }
    </style>
</head>
<body>
    <h1>Athlete Tracker</h1>
    <label>
        <input type="checkbox" id="toggleAnimation" checked> Animate Lines
    </label>
    <div class="map-container">
        <svg id="map" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet"></svg>
    </div>

    <table>
        <thead>
            <tr>
                <th id="nameHeader" onclick="toggleSort('name')">
                    Athlete Name
                    <div class="sort-menu">
                        <button onclick="sortTable('name', 'asc')">Ascending</button>
                        <button onclick="sortTable('name', 'desc')">Descending</button>
                    </div>
                </th>
                <th id="hometownHeader" onclick="toggleSort('hometown')">
                    Hometown
                    <div class="sort-menu">
                        <button onclick="sortTable('hometown', 'asc')">Ascending</button>
                        <button onclick="sortTable('hometown', 'desc')">Descending</button>
                    </div>
                </th>
                <th id="schoolHeader" onclick="toggleSort('school')">
                    School
                    <div class="sort-menu">
                        <button onclick="sortTable('school', 'asc')">Ascending</button>
                        <button onclick="sortTable('school', 'desc')">Descending</button>
                    </div>
                </th>
                <th id="sportHeader" onclick="toggleSort('sport')">
                    Sport
                    <div class="sort-menu">
                        <button onclick="sortTable('sport', 'asc')">Ascending</button>
                        <button onclick="sortTable('sport', 'desc')">Descending</button>
                    </div>
                </th>
                <th>Show</th>
            </tr>
        </thead>
        <tbody id="athleteTable"></tbody>
    </table>

    <script>
        const width = 1000;
        const height = 600;
        const svg = d3.select("#map");

        const projection = d3.geoAlbersUsa().translate([width / 2, height / 2]).scale(1200);
        const path = d3.geoPath().projection(projection);

        d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json").then(us => {
            svg.append("g")
                .selectAll("path")
                .data(topojson.feature(us, us.objects.states).features)
                .enter().append("path")
                .attr("class", "map")
                .attr("d", path);
        });

        const athletes = [
            { name: "Player 1", hometown: "Chicago, IL", school: "Washington, DC", sport: "Football" },
            { name: "Player 2", hometown: "Los Angeles, CA", school: "Boston, MA", sport: "Basketball" },
            { name: "Player 3", hometown: "Gainseville, FL", school: "Champaign, IL", sport: "Basketball" },
            { name: "Player 4", hometown: "Houston, TX", school: "Scottsdale, AZ", sport: "Basketball" },
            { name: "Player 4", hometown: "Napa, CA", school: "Eugene, OR", sport: "Basketball" },
        ];

        function populateTable() {
            const tableBody = document.getElementById("athleteTable");
            tableBody.innerHTML = "";
            athletes.forEach((athlete, index) => {
                let row = tableBody.insertRow();
                row.insertCell(0).textContent = athlete.name;
                row.insertCell(1).textContent = athlete.hometown;
                row.insertCell(2).textContent = athlete.school;
                row.insertCell(3).textContent = athlete.sport;
                let showCell = row.insertCell(4);
                let button = document.createElement("button");
                button.textContent = "Show";
                button.onclick = () => {
                    svg.selectAll(".line, .dot").remove();
                    drawSingleAthlete(athlete);
                };
                showCell.appendChild(button);
            });
        }

        async function getCoordinates(city) {
            const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}`);
            const data = await response.json();
            if (data.length > 0) {
                return [parseFloat(data[0].lon), parseFloat(data[0].lat)];
            }
            return null;
        }

        async function drawLines() {
            for (let athlete of athletes) {
                await drawSingleAthlete(athlete);
            }
        }

        async function drawSingleAthlete(athlete) {
            const hometownCoords = await getCoordinates(athlete.hometown);
            const schoolCoords = await getCoordinates(athlete.school);
            if (hometownCoords && schoolCoords) {
                drawCurvedLine(hometownCoords, schoolCoords);
                addDots(hometownCoords, schoolCoords);
            }
        }

        function drawCurvedLine(hometown, school) {
            const midpoint = [(hometown[0] + school[0]) / 2, (hometown[1] + school[1]) / 2 + 5];
            const lineData = [hometown, midpoint, school].map(d => projection(d));

            let line = svg.append("path")
                .datum(lineData)
                .attr("class", "line")
                .attr("d", d3.line().curve(d3.curveBasis))
                .attr("stroke-dasharray", function() { return this.getTotalLength(); })
                .attr("stroke-dashoffset", function() { return this.getTotalLength(); });

            if (document.getElementById("toggleAnimation").checked) {
                line.transition()
                    .duration(2000)
                    .ease(d3.easeLinear)
                    .attr("stroke-dashoffset", 0);
            } else {
                line.attr("stroke-dashoffset", 0);
            }
        }

        function addDots(hometown, school) {
            svg.append("circle")
                .attr("class", "dot")
                .attr("cx", projection(hometown)[0])
                .attr("cy", projection(hometown)[1])
                .attr("r", 3);
            svg.append("circle")
                .attr("class", "dot")
                .attr("cx", projection(school)[0])
                .attr("cy", projection(school)[1])
                .attr("r", 3);
        }

        // Sorting functionality
        let currentSort = {};

        function toggleSort(column) {
            let sortOrder = currentSort[column] === 'asc' ? 'desc' : 'asc';
            currentSort[column] = sortOrder;

            // Update the header arrow direction
            document.querySelectorAll('th').forEach(th => {
                th.classList.remove('asc', 'desc');
            });

            const header = document.getElementById(column + 'Header');
            header.classList.add(sortOrder);

            sortTable(column, sortOrder);
        }

        function sortTable(category, order) {
            const sortedAthletes = [...athletes].sort((a, b) => {
                if (category === 'name') {
                    return order === 'asc' ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name);
                } else if (category === 'hometown') {
                    return order === 'asc' ? a.hometown.localeCompare(b.hometown) : b.hometown.localeCompare(a.hometown);
                } else if (category === 'school') {
                    return order === 'asc' ? a.school.localeCompare(b.school) : b.school.localeCompare(a.school);
                } else if (category === 'sport') {
                    return order === 'asc' ? a.sport.localeCompare(b.sport) : b.sport.localeCompare(a.sport);
                }
                return 0;
            });

            athletes.length = 0;
            athletes.push(...sortedAthletes);
            populateTable();
        }

        document.getElementById("toggleAnimation").addEventListener("change", () => {
            svg.selectAll(".line").remove();
            drawLines();
        });

        populateTable();
        drawLines();
    </script>
</body>
</html>








